import React, { useState, useEffect } from 'react';
import { useSelector } from 'react-redux';
import CountrySelect from './CountrySelect';
import { FaTrashAlt } from 'react-icons/fa';

const Chekout = () => {
  const { cart } = useSelector(state => state);
  const [countryCode, setCountryCode] = useState('');
  const isAlgeria = countryCode === 'DZ';
  const currency = isAlgeria ? 'DA' : 'â‚¬';

  const total = cart.items?.reduce((sum, item) => {
    return sum + (item.price || 0) * (item.quantity || 1);
  }, 0) || 0;

  useEffect(() => {
    window.scrollTo(0, 0); // UX
  }, []);

  return (
    <div className="checkout-form">
      <h2 className="checkout-title">Formulario de Pago</h2>

      {/* âœ… RESUMEN DE LA OBRA(S) - VERSIÃ“N COMPACTA */}
      <div className="checkout-summary">
        <h3>ğŸ§¾ Resumen del Pedido</h3>
        {cart.items?.map((item) => {
          const postId = item.postId?._id || 'sin-id';
          return (
            <div key={postId} className="cart-item-card-chekout">
              <img
                src={item.postId?.images?.[0]?.url || 'imagen_por_defecto.jpg'}
                alt={item.postId?.title || 'obra'}
                className="cart-item-image-chekout"
              />
              <div className="cart-item-details-checkout">
                <p className="cart-item-title-chekout">{item.postId?.title || 'Sin tÃ­tulo'}</p>
                <p className="compact-price">
                  {item.quantity} x {item.price?.toFixed(2)} {currency}
                </p>
                <p className="compact-subtotal">
                  <strong>Total:</strong> {(item.quantity * item.price).toLocaleString()} {currency}
                </p>
              </div>
            </div>
          );
        })}
        <p className="checkout-total">
          <strong>Total a pagar:</strong> {total.toLocaleString()} {currency}
        </p>
      </div>

      {/* âœ… GUÃA */}
      <div className="checkout-guide">
        <h3>ğŸ“Œ InformaciÃ³n previa al pago</h3>
        <p>
          Por favor selecciona tu <strong>paÃ­s de residencia</strong> para continuar.
          Dependiendo de tu ubicaciÃ³n, te mostraremos las opciones bancarias disponibles.
        </p>
      </div>

      {/* âœ… SELECTOR DE PAÃS */}
      <div className="selector-wrapper">
        <label htmlFor="country" className="label-country">ğŸŒ Selecciona tu paÃ­s:</label>
        <CountrySelect onChange={setCountryCode} />
      </div>

      {/* âœ… OPCIONES DE PAGO */}
      <div className="bank-section">
        {isAlgeria ? (
          <div className="bank-info algeria">
            <h4>ğŸ“¬ InformaciÃ³n CCP â€“ AlgÃ©rie Poste</h4>
            <p><strong>Cuenta CCP:</strong> 12345.78.90</p>
            <p><strong>Clave:</strong> 89</p>
            <p><strong>Documentos:</strong> Identidad, residencia, CH1, firma CH25</p>
            <p><strong>LÃ­mites diario:</strong> 200â€¯000â€¯DA; rÃ¡pido: 30â€¯000â€¯DA</p>
            <p><strong>Consultas:</strong> Presencial, eâ€‘CCP, SMS (603), TelÃ©fono (15â€‘30)</p>
          </div>
        ) : (
          <div className="bank-info international">
            <h4>ğŸ¦ InformaciÃ³n Bancaria - SWIFT</h4>
            <p><strong>Nombre:</strong> Mohamed Benali</p>
            <p><strong>Banco:</strong> SociÃ©tÃ© GÃ©nÃ©rale</p>
            <p><strong>IBAN:</strong> FR76 3000 3036 2000 0500 0001 234</p>
            <p><strong>SWIFT:</strong> SOGEFRPP</p>
          </div>
        )}
      </div>

      {/* âœ… MENSAJE FINAL */}
      <div className="payment-notice">
        <p>
          ğŸ“¸ <strong>Importante:</strong> Una vez realizado el pago, por favor envÃ­ame un justificante (foto o captura) por email o WhatsApp para poder proceder con la entrega de tu obra.
        </p>
      </div>

      <div className="contact-info">
        <h4>ğŸ“¤ Â¿DÃ³nde enviar el justificante de pago?</h4>
        <p><strong>ğŸ“§ Correo:</strong> mohamed.artista@example.com</p>
        <p><strong>ğŸ“± WhatsApp:</strong> +213 661 23 45 67</p>
      </div>
    </div>
  );
};

export default Chekout;
